reset
#{InnerRadius=3.13563}
#{OuterRadius=3.65125}
#{Leng=137}
#{PipeInnRad=0.62611}
#{PipeOutRad=0.85725}
## if we keep CenterP=(OuterRadius+PipeOutRad)*sqrt(2.)/2, we have some issues with bodies for slivers not split
##{CenterP=3.18799}
#{CenterP=(OuterRadius+PipeOutRad)*sqrt(2.)/2}
#{MoveZ=68.61557}
#{height1=0.51562}
#{height2=height1}
#{supportSteel=0.75}
#{support=0.51886}
#{WebcutBox=0.8}
#{OutsideWaterX=24}
#{OutsideWaterY=24}
#{OutsideWaterZ=150}
#{OutsideBox=11.44166654}
#{OutsideBoxSmall=9}
create cylinder height {Leng} radius {OuterRadius}
create cylinder height {Leng} radius {InnerRadius}
create cylinder height {Leng} radius {PipeOutRad}
create cylinder height {Leng} radius {PipeInnRad}
# subtract body  ( at 0 0 0 ordinal 2 ordered )  from body  ( at 0 0 0 ordinal 1 ordered )  keep
subtract volume  ( at 0 0 0 ordinal 2 ordered )  from volume  ( at 0 0 0 ordinal 1 ordered )  keep
delete volume  ( at 0 0 0 ordinal 1 ordered ) 
subtract volume  ( at 0 0 0 ordinal 3 ordered )  from volume  ( at 0 0 0 ordinal 2 ordered )  keep
delete volume  ( at 0 0 0 ordinal 2 ordered ) 
move volume  ( at 0 0 0 ordinal 2 at 0 0 0 ordinal 4 ordered )  x {CenterP} y {CenterP} include_merged
brick x {supportSteel*2} y {supportSteel*2} z 3
brick x {support*2} y {support*2} z 3
rotate volume  ( at 0 0 0 ordinal 3 at 0 0 0 ordinal 4 ordered )  angle 90 about x include_merged
rotate volume  ( at 0 0 0 ordinal 3 at 0 0 0 ordinal 4 ordered )  angle 135 about z include_merged
move volume  ( at 0 0 0 ordinal 3 at 0 0 0 ordinal 4 ordered )  x 2 y 2 z { Leng/2 - 2 } include_merged
## Subtract main tube before cutting connecting tube:
subtract body  ( at 2 2 66.5 ordinal 1 ordered )  from body  ( at 0 0 0 ordinal 2 ordered )  keep
delete volume  ( at 0 0 0 ordinal 2 ordered ) 
## Subtract connecting pipe from smaller pipe:
subtract body  ( at 3.18799 3.18799 0 ordinal 1 at 3.18799 3.18799 0 ordinal 2 ordered )  from body  ( at 2 2 66.5 ordinal 1 ordered )  keep
delete volume  ( at 2 2 66.5 ordinal 1 ordered ) 
subtract body  ( at 2 2 66.5 ordinal 1 ordered )  from body  ( at 3.18799 3.18799 0 ordinal 2 ordered )  keep
delete volume  ( at 3.18799 3.18799 0 ordinal 2 ordered ) 
subtract body  ( at 3.18799 3.18799 0 ordinal 1 ordered )  from body  ( at 2 2 66.5 ordinal 1 ordered )  keep
delete volume  ( at 2 2 66.5 ordinal 1 ordered ) 
## Subtract connecting pipe from larger pipe:
subtract body  ( at 0 0 0 ordinal 1 at 0 0 0 ordinal 2 ordered )  from body  ( at 1.91688 1.91688 66.5 ordinal 1 ordered )  keep
delete volume  ( at 1.91688 1.91688 66.5 ordinal 1 ordered ) 
subtract body  ( at 0 0 0 ordinal 1 ordered )  from body  ( at 1.93977 1.93977 66.5 ordinal 1 ordered )  keep
delete volume  ( at 1.93977 1.93977 66.5 ordinal 1 ordered ) 
## Finally, separate inside of connecting pipe from outside:
subtract body  ( at 2.56343 2.56343 66.5 ordinal 1 ordered )  from body  ( at 2.52364 2.52364 66.5 ordinal 1 ordered )  keep
delete volume  ( at 2.52364 2.52364 66.5 ordinal 1 ordered ) 
create cylinder height {height1} radius {OuterRadius}
create cylinder height {height2} radius {PipeOutRad}
move volume  ( at 0 0 0 ordinal 3 ordered )  z {Leng/2 + height1/2} include_merged
move volume  ( at 0 0 0 ordinal 3 ordered )  x {CenterP} y {CenterP} z {Leng/2 + height2/2} include_merged
brick x {OutsideWaterX} y {OutsideWaterY} z {OutsideWaterZ}
move volume ( at 0 0 0 ordinal 3 ordered ) z {(OutsideWaterZ-Leng)/2} include_merged
## Subtract everything from the outside water
unite volume  ( at 0 0 0 ordinal 1 at 3.18799 3.18799 0 ordinal 1 at 0 0 0 ordinal 2 at 3.18799 3.18799 0 ordinal 2 at 2.56343 2.56343 66.5 ordinal 1 at 2.52364 2.52364 66.5 ordinal 1 at 0 0 68.7578 ordinal 1 at 3.18799 3.18799 68.7578 ordinal 1 ordered )  keep
subtract volume  ( at 0.196995 0.196995 0.25781 ordinal 1 ordered )  from  ( at 0 0 6.5 ordinal 1 ordered ) 
section volume all xplane
section volume all yplane
webcut volume  ( at 2.52364 2.52364 66.5 ordinal 1 ordered )  with plane surface  ( at 2.81295 2.07917 66.5 ordinal 1 ordered ) 
webcut volume  ( at 2.34745 2.62226 66.5 ordinal 1 ordered )  with plane surface  ( at 2.07917 2.81295 66.5 ordinal 1 ordered ) 
webcut volume all with plane surface  ( at 2.44606 2.44606 65.75 ordinal 1 ordered ) 
webcut volume all with plane surface  ( at 2.44606 2.44606 67.25 ordinal 1 ordered ) 
webcut volume all with plane surface  ( at 1.82563 1.82563 69.0156 ordinal 1 ordered ) 
webcut volume all with plane surface  ( at 1.82563 1.82563 68.5 ordinal 2 ordered ) 
webcut volume all with plane surface  ( at 2.56343 2.56343 65.9811 ordinal 1 ordered ) 
rotate volume all angle 45 about z include_merged
section volume all xplane
delete volume  ( at -1.66591 2.89531 66.6156 ordinal 1 at -0.63443 3.56897 65.8656 ordinal 1 at -1.66591 2.89531 65.8656 ordinal 1 at -0.63443 3.56897 66.6156 ordinal 1 ordered ) 
webcut volume  ( at 0.25943 3.62524 66.5 ordinal 1 ordered )  with sheet extended from surface  ( at 0.273766 3.69614 67.1344 ordinal 1 ordered ) 
# webcut volume all with plane yplane offset 0 rotate 45 about z noimprint nomerge
imprint all
merge all
# volume 2 4 9 11 14 16 17 20 21 22 28 29 31 32 36 37 38 41 43 44  size 0.15
volume  ( at 1.10861 1.56781 66.6156 ordinal 1 at 0.313055 4.5085 66.6156 ordinal 1 at 1.29091 2.93424 67.875 ordinal 1 at 0.428625 4.5085 66.6156 ordinal 1 at 0.25943 3.45925 66.5 ordinal 1 at 1.29091 1.82562 68.7578 ordinal 1 at 0.428625 4.5085 68.7578 ordinal 1 at 0.63443 3.56897 66.6156 ordinal 1 at 0.25943 3.45925 65.8656 ordinal 1 at 0.25943 3.45925 67.1344 ordinal 1 at 1.10861 1.56781 67.875 ordinal 1 at 0.313055 4.5085 67.875 ordinal 1 at 1.66591 2.89531 66.6156 ordinal 1 at 0.428625 4.5085 67.875 ordinal 1 at 1.10861 1.56781 65.8656 ordinal 1 at 0.313055 4.5085 65.8656 ordinal 1 at 0.428625 4.5085 65.8656 ordinal 1 at 0.63443 3.56897 65.8656 ordinal 1 at 1.66591 2.89531 65.8656 ordinal 1 at 0.25943 3.90466 66.5 ordinal 1 ordered )  size 0.15

# volume 18 23 24 25 26  27 33 34 35 40 size 0.5
volume  ( at 4.24264 9.77619 66.6156 ordinal 1 at 1.10861 1.56781 -1.375 ordinal 1 at 0.313055 4.5085 -1.375 ordinal 1 at 1.29091 2.93424 -1.375 ordinal 1 at 0.428625 4.5085 -1.375 ordinal 1 at 4.24264 9.77619 -1.375 ordinal 1 at 4.24264 8.48528 75.2578 ordinal 1 at 4.24264 9.77619 67.875 ordinal 1 at 4.24264 9.77619 68.7578 ordinal 1 at 4.24264 9.77619 65.8656 ordinal 1 ordered )  size 0.5

# order mesh vol  36 2 28 16 44 38 11 32 37 4 29 17 22 14 21 40 18 34 35 20 41 9 31 43

 mesh volume  ( at 1.10861 1.56781 65.8656 ordinal 1 at 1.10861 1.56781 66.6156 ordinal 1 at 1.10861 1.56781 67.875 ordinal 1 at 1.29091 1.82562 68.7578 ordinal 1 at 0.25943 3.90466 66.5 ordinal 1 at 0.428625 4.5085 65.8656 ordinal 1 at 0.428625 4.5085 66.6156 ordinal 1 at 0.428625 4.5085 67.875 ordinal 1 at 0.313055 4.5085 65.8656 ordinal 1 at 0.313055 4.5085 66.6156 ordinal 1 at 0.313055 4.5085 67.875 ordinal 1 at 0.428625 4.5085 68.7578 ordinal 1 at 0.25943 3.45925 67.1344 ordinal 1 at 0.25943 3.45925 66.5 ordinal 1 at 0.25943 3.45925 65.8656 ordinal 1 at 4.24264 9.77619 65.8656 ordinal 1 at 4.24264 9.77619 66.6156 ordinal 1 at 4.24264 9.77619 67.875 ordinal 1 at 4.24264 9.77619 68.7578 ordinal 1 at 0.63443 3.56897 66.6156 ordinal 1 at 0.63443 3.56897 65.8656 ordinal 1 at 1.29091 2.93424 67.875 ordinal 1 at 1.66591 2.89531 66.6156 ordinal 1 at 1.66591 2.89531 65.8656 ordinal 1 ordered ) 

vol all size 1.5 
mesh volume all


# symmetry back
volume all copy reflect plane xplane
rotate volume all angle -45 about z include_merged

volume all copy reflect plane xplane
volume all copy reflect plane yplane

merge all
save as "pipe.cub" overwrite



